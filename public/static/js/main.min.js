const app=new Vue({el:"#app",data:{ajax:"ajax.php",key:!1,list:[],keys:[],currentData:[],order:"",isClick:0,type:"id",pages:{totalPage:0,pageNum:8,currentPage:1}},methods:{Toast:Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:a=>{a.addEventListener("mouseenter",Swal.stopTimer),a.addEventListener("mouseleave",Swal.resumeTimer)}}),sort(a){this.isClick=!this.isClick,this.order=this.isClick?"desc":"",this.type=a,$.ajax({url:this.ajax,type:"POST",dataType:"json",data:{action:"selectAll",type:a,order:this.order},success:a=>{this.list=a,this.currentData=this.list.slice((this.pages.currentPage-1)*this.pages.pageNum,this.pages.currentPage*this.pages.pageNum),this.keys=[],this.currentData.forEach(a=>{this.keys.push({id:a.id,status:!1})})}})},onCheck(a){this.keys[a].status=!this.keys[a].status},addBtn(){Swal.fire({title:"<span><i class='fas fa-plus-square'></i> \u6DFB\u52A0\u6210\u5458</span>",html:`<div class="row">
                <label for="name" class="col-4 mb-2"><i class="fas fa-user"></i> 姓名：</label>
                <input type="text" id="name" class="col-8 form-control mb-2" name="name" placeholder="请输入成员姓名" required >
                <label for="sex" class="col-4 mb-2"><i class="fab fa-android"></i> 性别：</label>
                <input type="text" id="sex" class="col-8 form-control mb-2" name="sex" placeholder="请输入成员性别" required>
                <label for="tel" class="col-4 mb-2"><i class="fas fa-phone"></i> 电话号码：</label>
                <input type="text" id="tel" class="col-8 form-control mb-2" name="tel" placeholder="请输入成员电话号码" required>
                <label for="room" class="col-4 mb-2"><i class="fas fa-door-closed"></i> 宿舍号：</label>
                <input type="text" id="room" class="col-8 form-control mb-2" name="room" placeholder="请输入成员宿舍号" required>
                <label for="major" class="col-4 mb-2"><i class="fas fa-project-diagram"></i> 专业：</label>
                <input type="text" id="major" class="col-8 form-control mb-2" name="major" placeholder="请输入成员专业" required>
              </div>`,showCloseButton:!0,confirmButtonText:"\u63D0\u4EA4"}).then(a=>{a.isConfirmed&&$.ajax({url:this.ajax,type:"POST",data:{action:"add",name:$("#name").val(),sex:$("#sex").val(),tel:$("#tel").val(),room:$("#room").val(),major:$("#major").val()},success:a=>{this.Toast.fire({title:a,icon:"success"}),$.ajax({url:this.ajax,type:"POST",dataType:"json",data:{action:"selectLastOne"},success:a=>{this.list.push(a),this.pages.totalPage===this.pages.currentPage&&(this.currentData=this.list.slice((this.pages.currentPage-1)*this.pages.pageNum,this.pages.currentPage*this.pages.pageNum),this.keys.push({id:a.id,status:!1})),0<this.list.length%this.pages.pageNum&&(this.pages.totalPage=Math.ceil(this.list.length/this.pages.pageNum))}})},error:a=>{this.Toast.fire({title:a,icon:"error"})}})})},delOneBtn(a){Swal.fire({icon:"warning",title:"\u786E\u8BA4\u5220\u9664\u5417\uFF1F",html:"\u5220\u9664\u4E4B\u540E\u65E0\u6CD5\u6062\u590D\u3002",showCancelButton:!0,cancelButtonText:"\u53D6\u6D88",confirmButtonText:"\u786E\u8BA4",reverseButtons:!0,focusCancel:!0}).then(b=>{b.isConfirmed&&$.ajax({url:this.ajax,type:"POST",data:{action:"delete",id:a},success:b=>{this.Toast.fire({icon:"success",title:b}),this.list.some((b,c)=>{if(b.id===a)return this.list.splice(c,1),!0}),this.delRefresh()},error:a=>{this.Toast.fire({icon:"error",title:a})}})})},async delBtn(){if(this.keys.find(a=>a.status)){let a=[];this.keys.forEach(b=>b.status&&a.push(b.id)),$.ajax({url:this.ajax,type:"POST",data:{action:"delMul",data:a.join(",")},success:b=>{this.Toast.fire({title:b,icon:"success"}),this.list=this.list.filter(b=>!a.includes(b.id)),this.delRefresh()},error:a=>{this.Toast.fire({title:a,icon:"error"})}})}else{const{value:a}=await Swal.fire({title:"\u5220\u9664\u6210\u5458",input:"number",inputLabel:"Id",inputPlaceholder:"\u8F93\u5165 \u6210\u5458id \u5220\u9664\u6210\u5458",inputAttributes:{min:1}});a&&$.ajax({url:this.ajax,type:"POST",data:{action:"delete",id:a},success:b=>{this.list.some((b,c)=>{if(b.id===a)return this.list.splice(c,1),!0}),this.Toast.fire({title:b,icon:"success"}),this.delRefresh()},error:a=>{this.Toast.fire({title:a,icon:"error"})}})}},allBtn(){this.key=!this.key,this.keys.forEach(a=>a.status=this.key)},switchPage(a){a===this.pages.currentPage||(this.pages.currentPage=a,this.currentData=this.list.slice((a-1)*this.pages.pageNum,a*this.pages.pageNum),this.keys=[],this.currentData.forEach(a=>{this.keys.push({id:a.id,status:!1})}))},loginBtn(){Swal.fire({title:"\u7BA1\u7406\u5458\u767B\u5F55",html:`<div class="row">
            <label for="user" class="col-4 mb-2"><i class="fas fa-user"></i> 用户名：</label>
            <input type="text" id="user" class="col-8 form-control mb-2" name="username" placeholder="*用户名或邮箱"/>
            <label for="pass" class="col-4 mb-2"><i class="fas fa-key"></i> 密  码：</label>
            <input type="password" id="pass" class="col-8 form-control mb-2" name="password" placeholder="*密码" />
          </div>`}).then(a=>{a.isConfirmed&&$.ajax({url:this.ajax,type:"POST",data:{action:"login",user:$("#user").val(),pass:$("#pass").val()},success:a=>{this.Toast.fire({title:a,icon:"success"}),setInterval(location.reload(),3e3)},error:a=>{this.Toast.fire({title:a,icon:"error"}),setInterval(this.loginBtn(),3e3)}})})},logoutBtn(){$.ajax({url:this.ajax,type:"POST",data:{action:"logout"},success:a=>{this.Toast.fire({title:a,icon:"success"}),setInterval(location.reload(),3e3)},error:a=>{this.Toast.fire({title:a,icon:"error"})}})},alter(a,b){$.ajax({url:this.ajax,type:"POST",data:{id:a,action:"selectIdOne"},dataType:"json",success:c=>{Swal.fire({title:"\u4FEE\u6539\u6210\u5458",html:`<div class="row">
              <label for="name" class="col-4 mb-2"><i class="fas fa-user"></i> 姓名：</label>
              <input type="text" id="name" class="col-8 form-control mb-2" name="name" value="${c.name}" placeholder="请输入成员姓名" required >
              <label for="sex" class="col-4 mb-2"><i class="fab fa-android"></i> 性别：</label>
              <input type="text" id="sex" class="col-8 form-control mb-2" name="sex" value="${c.sex}" placeholder="请输入成员性别" required>
              <label for="tel" class="col-4 mb-2"><i class="fas fa-phone"></i> 电话号码：</label>
              <input type="text" id="tel" class="col-8 form-control mb-2" name="tel" value="${c.tel}" placeholder="请输入成员电话号码" required>
              <label for="room" class="col-4 mb-2"><i class="fas fa-door-closed"></i> 宿舍号：</label>
              <input type="text" id="room" class="col-8 form-control mb-2" name="room" value="${c.room}" placeholder="请输入成员宿舍号" required>
              <label for="major" class="col-4 mb-2"><i class="fas fa-project-diagram"></i> 专业：</label>
              <input type="text" id="major" class="col-8 form-control mb-2" name="major" value="${c.major}" placeholder="请输入成员专业" required>
            </div>`,showCloseButton:!0,confirmButtonText:"\u63D0\u4EA4"}).then(c=>{if(c.isConfirmed){const c={id:a,name:$("#name").val(),sex:$("#sex").val(),tel:$("#tel").val(),room:$("#room").val(),major:$("#major").val()};$.ajax({url:this.ajax,type:"POST",data:Object.assign({action:"alter"},c),success:a=>{this.Toast.fire({title:a,icon:"success"}),Vue.set(this.list,b,c),(8>b&&1===this.pages.currentPage||Math.ceil(b/this.pageNum)===this.pages.currentPage)&&(this.currentData=this.list.slice((this.pages.currentPage-1)*this.pages.pageNum,this.pages.currentPage*this.pages.pageNum),Object.assign(this.keys[b],{status:!1}))},error:a=>{this.Toast.fire({title:a,icon:"error"})}})}})}})},delRefresh(){1<this.pages.currentPage&&this.pages.currentPage--,1===this.currentData.length&&(this.pages.totalPage=Math.ceil(this.list.length/this.pages.pageNum)),this.currentData=this.list.slice((this.pages.currentPage-1)*this.pages.pageNum,this.pages.currentPage*this.pages.pageNum),this.keys=[],this.currentData.forEach(a=>{this.keys.push({id:a.id,status:!1})})}},mounted(){$.ajax({url:this.ajax,type:"POST",dataType:"json",data:{action:"selectAll",type:"id",order:"asc"},success:a=>{this.list=a,this.pages.totalPage=Math.ceil(a.length/this.pages.pageNum),this.currentData=this.list.slice(0,this.pages.pageNum),this.currentData.forEach(a=>{this.keys.push({id:a.id,status:!1})})}})}});